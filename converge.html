<!DOCTYPE html>
<html>

<head>
    <title></title>
    <meta charset="utf-8" />
    <script type='text/javascript' src='https://www.bing.com/api/maps/mapcontrol?callback=GetMap' async defer></script>
    <script type='text/javascript'>
        function GetMap() {
            var map = new Microsoft.Maps.Map('#myMap', {
                credentials: 'AnH2g7aIGWg0fbknGUkBgIkHuQE92PVrFktrKYRql4UBSskXajCI_c0R6rUPNxuh',
                center: new Microsoft.Maps.Location(53.348232, -1.750562),
                zoom: 8,
                mapTypeId: Microsoft.Maps.MapTypeId.ordnanceSurvey
            });

            //Best case
            var start = new Microsoft.Maps.Location(54.135835, -0.789643);
            var finish = new Microsoft.Maps.Location(53.348232, -1.750562);
            var coords = [finish, start];
            var line = new Microsoft.Maps.Polyline(coords, {
                strokeColor: 'red',
                strokeThickness: 3,
                //      strokeDashArray: [4, 4]
            });
            map.entities.push(line);

            // Actual route
            var coords = displayRunner("https://davidbetteridge.github.io/data/714_634.kml", map)
            var coords = displayRunner("https://davidbetteridge.github.io/data/71_HelenPike.kml", map)
         

            //Add the rings
            Microsoft.Maps.loadModule('Microsoft.Maps.SpatialMath', function () {
                var circle1 = createCircle(finish, 30, 'rgba(0,0,150,0.1)');
                map.entities.push(circle1);

                var circle2 = createCircle(finish, 60, 'rgba(0,0,150,0.1)');
                map.entities.push(circle2);

                var circle3 = createCircle(finish, 90, 'rgba(0,0,150,0.2)');
                map.entities.push(circle3);

            });
        }

        function createCircle(center, radius, color) {
            //Calculate the locations for a regular polygon that has 36 locations which will result in an approximate circle.
            var locs = Microsoft.Maps.SpatialMath.getRegularPolygon(center, radius, 36, Microsoft.Maps.SpatialMath.DistanceUnits.Miles);
            return new Microsoft.Maps.Polygon(locs, { fillColor: color, strokeThickness: 0 });
        }

        function displayRunner(xmlFile, map) {

            function handler() {
                if (this.status == 200 &&
                    this.responseXML != null) {
                    var xmlDoc = this.responseXML;
                    var coords = [];

                    var req = xmlDoc.getElementsByTagName("LookAt");
                    for (var i = 0; i < req.length; i++) {
                        var longitude = req[i].getElementsByTagName("longitude")[0].childNodes[0].nodeValue;
                        var latitude = req[i].getElementsByTagName("latitude")[0].childNodes[0].nodeValue;
                        coords.push(new Microsoft.Maps.Location(latitude, longitude));
                    }

                    var line = new Microsoft.Maps.Polyline(coords, {
                        strokeColor: 'blue',
                        strokeThickness: 3,
                        // strokeDashArray: [4, 4]
                    });
                    map.entities.push(line);
                } else {
                    alert("error");
                }
            }

            var client = new XMLHttpRequest();
            client.onload = handler;
            client.open("GET", xmlFile);
            client.send();
        }

    </script>
</head>

<body>
    <div id="myMap" style="position:relative;width:1000px;height:850px;"></div>
</body>